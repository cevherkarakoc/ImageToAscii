<!DOCTYPE html>
<meta charset="utf-8">
<body style="font: 12px/7px consolas">
<input id="file" type="file" accept="image/*"> <br> <br>
<span>Width : </span> <input id="char" type="text" value="100"> <span>characters</span> <br> <br>
<span>Background-color : </span> <input id="backgroundColor" type="text" value="white"> <span>(example:"blue", "#609164" ,rgb(145,96,141))</span> <br> <br>
<span>Color : </span> <input id="color" type="checkbox" value="true"> <br> <br>
<script>
	
	function AsImage(dataURI){
		var img = this.img = new Image;
		this.dataURI = dataURI;
		img.addEventListener("load",this.imageLoaded.bind(this));
		img.src=this.dataURI;
	}
	
	AsImage.prototype.imageLoaded = function(){
		var startTime = (new Date()).getTime();
		var char = document.getElementById('char').value;
		var color = document.getElementById('color').checked;
		var backgroundColor = document.getElementById('backgroundColor').value;
		
		var ratio = this.img.width/char;
		this.img.width = char;
		this.img.height /= ratio;
		
		this.canvas = document.createElement('canvas');
		this.canvas.width = this.img.width;
		this.canvas.height = this.img.height;
		this.canvasContext = this.canvas.getContext("2d");
		this.canvasContext.drawImage(this.img,0,0,this.canvas.width,this.canvas.height);
		
		var imageData = this.canvasContext.getImageData(0,0,this.canvas.width, this.canvas.height);
		var data = imageData.data;
		
		this.canvas.width = char*7;
		this.canvas.height = this.img.height*7;
		this.canvasContext = this.canvas.getContext("2d");		
		this.canvasContext.font = "12px consolas";
		this.canvasContext.fillStyle = backgroundColor;
		this.canvasContext.fillRect(0,0,this.canvas.width,this.canvas.height)
		
		var ascii = ["#","@","%","*", "+","-",":",":","."];
		var x=0,y=-7;
		
		var r,g,b,avg,c;
		for (var i = 0; i < data.length; i += 4) {
			r=data[i], g = data[i +1], b = data[i +2];
      		avg = (r + g + b) / 3;
			c = ascii[Math.floor(avg/30)];
			
			if(color) this.canvasContext.fillStyle = "RGB("+r+","+g+","+b+")";
			else this.canvasContext.fillStyle = "black";
			
			x+=7;
			if(i%(4*char)===0){
				y+=7;
				x=0;
			}
			
			this.canvasContext.fillText(c,x,y);	
    	}
		
		document.body.appendChild(this.canvas);
		document.body.appendChild(document.createElement("br"));
		
		console.log((new Date()).getTime() - startTime);
	}
	
	
	document.addEventListener('DOMContentLoaded', function(event) {
	var inputEl = document.getElementById('file');
	
	document.querySelector('input').addEventListener('change', function() {
		
		var file = inputEl.files[0];
		var reader = new FileReader();
		reader.onloadend = function () {
			new AsImage(reader.result);
		}
		reader.readAsDataURL(file);
	});
});
</script>
</body>